repos:
  # ============================================================
  # 1Ô∏è‚É£ BASIC HYGIENE (Everyone must have this)
  # ============================================================
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      - id: trailing-whitespace # Remove accidental spaces
      - id: end-of-file-fixer # Ensure newline at EOF
      - id: check-yaml # Validate YAML files
      - id: check-json # Validate JSON files
      - id: check-merge-conflict # Prevent committing conflicts
      - id: check-added-large-files # üö´ Block large files
        args:
          - '--maxkb=500' # 500KB max (safe for GitHub)
      - id: detect-private-key # üö´ Block private keys

  # ============================================================
  # 2Ô∏è‚É£ SECURITY GUARDRAILS (VERY IMPORTANT)
  # ============================================================
  - repo: local
    hooks:
      - id: block-env-files
        name: üõë Block .env files
        entry: 'Do not commit .env files'
        language: fail
        files: '^\.env$'

      - id: block-credentials
        name: üõë Block credential-like files
        entry: 'Credential files detected'
        language: fail
        files: '(credentials|secrets|keys)\.(yml|yaml|json|txt)$'

      - id: block-large-csv
        name: üö´ Prevent large CSV commits
        entry: 'Large CSV files are not allowed in Git'
        language: fail
        files: '\.csv$'
        exclude: '^01_data_sources/raw_sample_files/' # Allow small samples only

  # ============================================================
  # 3Ô∏è‚É£ SQL QUALITY (Snowflake + dbt)
  # ============================================================
  - repo: https://github.com/sqlfluff/sqlfluff
    rev: 4.0.0a2
    hooks:
      - id: sqlfluff-lint
        name: SQLFluff Lint (Snowflake + jinja)
        args:
          - --dialect=snowflake
          - --templater=jinja
          - --exclude-rules=L031,CP02 # ‚úÖ ADDED: Match .sqlfluff config
        files: ^(03_dbt/models/|02_snowflake/02_ingestion/|02_snowflake/03_quality_checks/).*\.sql$

      - id: sqlfluff-fix
        name: SQLFluff Auto-Fix (Snowflake + jinja)
        args:
          - --dialect=snowflake
          - --templater=jinja
          - --exclude-rules=L031,CP02 # ‚úÖ ADDED: Match .sqlfluff config
        files: ^(03_dbt/models/|02_snowflake/02_ingestion/|02_snowflake/03_quality_checks/).*\.sql$

  # ============================================================
  # 4Ô∏è‚É£ DOCUMENTATION QUALITY
  # ============================================================
  - repo: https://github.com/igorshubovych/markdownlint-cli
    rev: v0.47.0
    hooks:
      - id: markdownlint
        name: Markdown Lint
        args:
          - --fix
        exclude: '(target/|dbt_packages/|logs/|\.dbt/)' # ‚úÖ ADDED: Skip dbt artifacts
